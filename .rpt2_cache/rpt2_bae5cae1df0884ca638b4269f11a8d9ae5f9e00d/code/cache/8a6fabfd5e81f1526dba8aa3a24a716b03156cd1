{
  "code": "import { GameControl } from \"./GameControl\";\r\nimport SmallMapImage from \"../graphic/SmallMapImage\";\r\nimport Player from \"../character/Player\";\r\nimport BattleImage from \"../map/BattleImage\";\r\nimport { NodeType } from \"../script/Node\";\r\nimport EnemyFactory from \"../map/EnemyFactory\";\r\nexport default class BattleScene extends Laya.Scene {\r\n    constructor(regionmap) {\r\n        super();\r\n        BattleScene.regionmap = regionmap;\r\n        for (let j = 0; j < regionmap.length; j++) {\r\n            for (let i = 0; i < regionmap[0].length; i++) {\r\n                if (regionmap[j][i] && regionmap[j][i].node.type == NodeType.e) {\r\n                    BattleScene.tmpMapX = i;\r\n                    BattleScene.tmpMapY = j;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    createChildren() {\r\n        super.createChildren();\r\n        this.loadScene(\"BattleScene\");\r\n    }\r\n    onAwake() {\r\n        BattleScene.Lv = this.lv;\r\n        BattleScene.battleimagedeal = [];\r\n        BattleScene.battleimagedeal.push(new BattleImage(this.battlesprite1));\r\n        BattleScene.battleimagedeal.push(new BattleImage(this.battlesprite2));\r\n        let tmpregion = BattleScene.regionmap[BattleScene.tmpMapY][BattleScene.tmpMapX];\r\n        BattleScene.battleimagedeal[BattleScene.battleindex].initMap(tmpregion.regiontype, tmpregion.tileArray, tmpregion.enmeyForce);\r\n        BattleScene.battleimagedeal[BattleScene.battleindex].mainsp.visible = true;\r\n        BattleScene.battleimagedeal[1 - BattleScene.battleindex].mainsp.visible = false;\r\n        let playercontroller = this.player.getComponent(Player);\r\n        playercontroller.maxHP = 12;\r\n        playercontroller.HP = 12;\r\n        BattleScene.player = this.player;\r\n        BattleScene.MapImage = new SmallMapImage(BattleScene.regionmap);\r\n        BattleScene.MapImage.visible = false;\r\n        this.addChild(BattleScene.MapImage);\r\n        BattleScene.MapImage.centerX = 0;\r\n        BattleScene.MapImage.centerY = 0;\r\n        this.map_button.on(Laya.Event.CLICK, BattleScene, () => { BattleScene.MapImage.redraw(BattleScene.tmpMapX, BattleScene.tmpMapY); BattleScene.MapImage.visible = !BattleScene.MapImage.visible; console.log(\"map\"); });\r\n        this.controller = new GameControl(playercontroller);\r\n        BattleScene.hearts = [];\r\n        BattleScene.hearts.push(this.heart1);\r\n        BattleScene.hearts.push(this.heart2);\r\n        BattleScene.hearts.push(this.heart3);\r\n        BattleScene.hearts.push(this.heart4);\r\n        BattleScene.hearts.push(this.heart5);\r\n        BattleScene.hearts.push(this.heart6);\r\n        this.addChild(this.controller);\r\n    }\r\n    static switchMap(delx, dely) {\r\n        BattleScene.MapImage.redraw(BattleScene.tmpMapX, BattleScene.tmpMapY);\r\n        console.log(BattleScene.regionmap);\r\n        let tmpregion = BattleScene.regionmap[BattleScene.tmpMapY][BattleScene.tmpMapX];\r\n        let preindex = BattleScene.battleindex;\r\n        let nowindex = BattleScene.battleindex = 1 - BattleScene.battleindex;\r\n        EnemyFactory.clearEnemey();\r\n        BattleScene.battleimagedeal[preindex].clearTiles();\r\n        BattleScene.battleimagedeal[preindex].mainsp.removeChild(BattleScene.player);\r\n        BattleScene.battleimagedeal[preindex].mainsp.x = -2000;\r\n        BattleScene.battleimagedeal[nowindex].mainsp.x = 0;\r\n        BattleScene.battleimagedeal[nowindex].initMap(tmpregion.regiontype, tmpregion.tileArray, tmpregion.enmeyForce);\r\n        BattleScene.player.x += delx;\r\n        BattleScene.player.y += dely;\r\n        console.log(BattleScene.player);\r\n        BattleScene.battleimagedeal[nowindex].mainsp.addChild(BattleScene.player);\r\n        BattleScene.battleimagedeal[BattleScene.battleindex].mainsp.visible = true;\r\n    }\r\n}\r\nBattleScene.battleindex = 0;\r\nBattleScene.hearts = [];\r\nBattleScene.tmpMapX = 0;\r\nBattleScene.tmpMapY = 0;\r\n",
  "references": [
    "/Users/huanggaole/PCGZelda/src/scene/GameControl.ts",
    "/Users/huanggaole/PCGZelda/src/graphic/SmallMapImage.ts",
    "/Users/huanggaole/PCGZelda/src/character/Player.ts",
    "/Users/huanggaole/PCGZelda/src/map/BattleImage.ts",
    "/Users/huanggaole/PCGZelda/src/script/Region.ts",
    "/Users/huanggaole/PCGZelda/src/map/BattleMaps.ts",
    "/Users/huanggaole/PCGZelda/src/script/Node.ts",
    "/Users/huanggaole/PCGZelda/src/map/EnemyFactory.ts"
  ]
}
