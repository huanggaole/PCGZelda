{
  "code": "import { GameControl } from \"./GameControl\";\r\nimport SmallMapImage from \"../graphic/SmallMapImage\";\r\nimport SkillLearningImage from \"../graphic/SkillLearningImage\";\r\nimport Player from \"../character/Player\";\r\nimport BattleImage from \"../map/BattleImage\";\r\nimport { RegionType } from \"../script/Region\";\r\nimport { NodeType } from \"../script/Node\";\r\nimport EnemyFactory from \"../map/EnemyFactory\";\r\nimport BulletFactory from \"../map/BulletFactory\";\r\nexport default class BattleScene extends Laya.Scene {\r\n    constructor(regionmap) {\r\n        super();\r\n        BattleScene.regionmap = regionmap;\r\n        for (let j = 0; j < regionmap.length; j++) {\r\n            for (let i = 0; i < regionmap[0].length; i++) {\r\n                if (regionmap[j][i] && regionmap[j][i].node.type == NodeType.e) {\r\n                    regionmap[j][i].tileArray[2][4] = 0;\r\n                    regionmap[j][i].tileArray[2][5] = 0;\r\n                    BattleScene.tmpMapX = i;\r\n                    BattleScene.tmpMapY = j;\r\n                }\r\n                if (regionmap[j][i] && (regionmap[j][i].node.type == NodeType.b || regionmap[j][i].node.type == NodeType.g)) {\r\n                    regionmap[j][i].tileArray[2][4] = 0;\r\n                    regionmap[j][i].tileArray[2][5] = 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    createChildren() {\r\n        super.createChildren();\r\n        this.loadScene(\"BattleScene\");\r\n    }\r\n    onAwake() {\r\n        BattleScene.Lv = this.lv;\r\n        BattleScene.battleimagedeal = [];\r\n        BattleScene.battleimagedeal.push(new BattleImage(this.battlesprite1));\r\n        BattleScene.battleimagedeal.push(new BattleImage(this.battlesprite2));\r\n        let tmpregion = BattleScene.regionmap[BattleScene.tmpMapY][BattleScene.tmpMapX];\r\n        BattleScene.lastRegionType = tmpregion.regiontype;\r\n        BattleScene.battleimagedeal[BattleScene.battleindex].initMap(tmpregion.regiontype, tmpregion.tileArray, tmpregion.enmeyForce);\r\n        BattleScene.battleimagedeal[BattleScene.battleindex].mainsp.visible = true;\r\n        BattleScene.battleimagedeal[1 - BattleScene.battleindex].mainsp.visible = false;\r\n        let playercontroller = this.player.getComponent(Player);\r\n        playercontroller.maxHP = 12;\r\n        playercontroller.HP = 12;\r\n        BattleScene.player = this.player;\r\n        BattleScene.princess = this.princess;\r\n        BattleScene.lvup_button = this.lvup;\r\n        BattleScene.MapImage = new SmallMapImage(BattleScene.regionmap);\r\n        BattleScene.SkillImage = new SkillLearningImage(this.player.getComponent(Player));\r\n        BattleScene.MapImage.visible = false;\r\n        BattleScene.SkillImage.visible = false;\r\n        this.addChild(BattleScene.MapImage);\r\n        BattleScene.MapImage.centerX = 0;\r\n        BattleScene.MapImage.centerY = 0;\r\n        this.map_button.on(Laya.Event.CLICK, BattleScene, () => { Laya.SoundManager.playSound(\"sound/menu-2.ogg\"); BattleScene.MapImage.redraw(BattleScene.tmpMapX, BattleScene.tmpMapY); BattleScene.MapImage.visible = !BattleScene.MapImage.visible; console.log(\"map\"); });\r\n        this.lvup.on(Laya.Event.CLICK, BattleScene, () => { Laya.SoundManager.playSound(\"sound/menu-1.ogg\"); BattleScene.SkillImage.visible = !BattleScene.SkillImage.visible; });\r\n        this.controller = new GameControl(playercontroller);\r\n        BattleScene.hearts = [];\r\n        BattleScene.hearts.push(this.heart1);\r\n        BattleScene.hearts.push(this.heart2);\r\n        BattleScene.hearts.push(this.heart3);\r\n        BattleScene.hearts.push(this.heart4);\r\n        BattleScene.hearts.push(this.heart5);\r\n        BattleScene.hearts.push(this.heart6);\r\n        this.addChild(this.controller);\r\n        this.addChild(BattleScene.SkillImage);\r\n        Laya.SoundManager.playMusic(\"music/theme-5.ogg\", 0);\r\n    }\r\n    static switchMap(delx, dely) {\r\n        BattleScene.MapImage.redraw(BattleScene.tmpMapX, BattleScene.tmpMapY);\r\n        console.log(BattleScene.regionmap);\r\n        let tmpregion = BattleScene.regionmap[BattleScene.tmpMapY][BattleScene.tmpMapX];\r\n        if (this.lastRegionType != tmpregion.regiontype) {\r\n            if (tmpregion.regiontype == RegionType.Grass) {\r\n                Laya.SoundManager.playMusic(\"music/theme-5.ogg\", 0);\r\n            }\r\n            else if (tmpregion.regiontype == RegionType.Desert) {\r\n                Laya.SoundManager.playMusic(\"music/theme-6.ogg\", 0);\r\n            }\r\n            else if (tmpregion.regiontype == RegionType.Snow) {\r\n                Laya.SoundManager.playMusic(\"music/theme-7.ogg\", 0);\r\n            }\r\n            else {\r\n                Laya.SoundManager.playMusic(\"music/theme-2.ogg\", 0);\r\n            }\r\n        }\r\n        this.lastRegionType = tmpregion.regiontype;\r\n        let preindex = BattleScene.battleindex;\r\n        let nowindex = BattleScene.battleindex = 1 - BattleScene.battleindex;\r\n        EnemyFactory.clearEnemey();\r\n        BulletFactory.clearBullet();\r\n        BattleScene.battleimagedeal[preindex].clearTiles();\r\n        BattleScene.battleimagedeal[preindex].mainsp.removeChild(BattleScene.player);\r\n        BattleScene.battleimagedeal[preindex].mainsp.x = -2000;\r\n        BattleScene.battleimagedeal[nowindex].mainsp.x = 0;\r\n        BattleScene.battleimagedeal[nowindex].initMap(tmpregion.regiontype, tmpregion.tileArray, tmpregion.enmeyForce);\r\n        BattleScene.player.x += delx;\r\n        BattleScene.player.y += dely;\r\n        console.log(BattleScene.player);\r\n        BattleScene.battleimagedeal[nowindex].mainsp.addChild(BattleScene.player);\r\n        BattleScene.battleimagedeal[BattleScene.battleindex].mainsp.visible = true;\r\n        if (tmpregion.node.type == NodeType.g) {\r\n            this.princess.visible = true;\r\n            Laya.SoundManager.playMusic(\"music/theme-18.ogg\", 0);\r\n            Laya.timer.once(500, this, () => {\r\n                Laya.SoundManager.playSound(\"sound/succes-3.ogg\");\r\n                alert(\"恭喜你！成功救出了公主！\");\r\n                alert(\"本游戏为字节跳动第二届EMagic Jam作品\");\r\n                alert(\"作者：黄高乐 huanggaole@bytedance.com\");\r\n                alert(\"感谢您的试玩～\");\r\n                alert(\"点击确定重新开始游戏。\");\r\n                location.reload();\r\n            });\r\n        }\r\n    }\r\n}\r\nBattleScene.battleindex = 0;\r\nBattleScene.hearts = [];\r\nBattleScene.tmpMapX = 0;\r\nBattleScene.tmpMapY = 0;\r\n",
  "references": [
    "/Users/huanggaole/PCGZelda/src/scene/GameControl.ts",
    "/Users/huanggaole/PCGZelda/src/graphic/SmallMapImage.ts",
    "/Users/huanggaole/PCGZelda/src/graphic/SkillLearningImage.ts",
    "/Users/huanggaole/PCGZelda/src/character/Player.ts",
    "/Users/huanggaole/PCGZelda/src/map/BattleImage.ts",
    "/Users/huanggaole/PCGZelda/src/script/Region.ts",
    "/Users/huanggaole/PCGZelda/src/map/BattleMaps.ts",
    "/Users/huanggaole/PCGZelda/src/script/Node.ts",
    "/Users/huanggaole/PCGZelda/src/map/EnemyFactory.ts",
    "/Users/huanggaole/PCGZelda/src/map/BulletFactory.ts"
  ]
}
