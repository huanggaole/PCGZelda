{
  "code": "import { RegionType } from \"../script/Region\";\r\nimport BattleMaps from \"./BattleMaps\";\r\nimport EnemyFactory from \"./EnemyFactory\";\r\nimport BulletFactory from \"./BulletFactory\";\r\nimport toDown from \"../events/toDown\";\r\nimport toUp from \"../events/toUp\";\r\nimport toLeft from \"../events/toLeft\";\r\nimport toRight from \"../events/toRight\";\r\nexport default class BattleImage {\r\n    constructor(battlesprite) {\r\n        this.ifcanMove = true;\r\n        this.mainsp = battlesprite;\r\n        this.tilePool = [];\r\n    }\r\n    initMap(regiontype, battlemap, enemyforce) {\r\n        this.enemyFactory = new EnemyFactory(this.mainsp);\r\n        this.bulletFactory = new BulletFactory(this.mainsp);\r\n        console.log(this.mainsp.numChildren);\r\n        for (let i = 0; i < this.mainsp.numChildren; i++) {\r\n            let c = this.mainsp.getChildAt(i);\r\n            let d = c.getComponent(toDown);\r\n            let u = c.getComponent(toUp);\r\n            let l = c.getComponent(toLeft);\r\n            let r = c.getComponent(toRight);\r\n            if (d) {\r\n                d.conce = true;\r\n            }\r\n            if (u) {\r\n                u.conce = true;\r\n            }\r\n            if (l) {\r\n                l.conce = true;\r\n            }\r\n            if (r) {\r\n                r.conce = true;\r\n            }\r\n        }\r\n        for (let j = 0; j < 5; j++) {\r\n            let tmppool = [];\r\n            for (let i = 0; i < 10; i++) {\r\n                let tmptile = Laya.Pool.getItemByClass('TileType', Laya.FontClip);\r\n                tmptile.skin = \"Battle/map1.png\";\r\n                tmptile.sheet = \"一八匕厂刀儿二几力人 入十又川寸大飞干工弓 广己口马门女山尸士巳 土兀夕小子贝比长车歹 斗厄方风父戈户火见斤\";\r\n                let tmprigid = tmptile.getComponent(Laya.RigidBody);\r\n                if (!tmprigid) {\r\n                    tmprigid = tmptile.addComponent(Laya.RigidBody);\r\n                }\r\n                tmprigid.type = \"static\";\r\n                tmprigid.gravityScale = 0;\r\n                let tmpcld = tmptile.getComponent(Laya.BoxCollider);\r\n                if (!tmpcld) {\r\n                    tmpcld = tmptile.addComponent(Laya.BoxCollider);\r\n                }\r\n                tmpcld.width = tmpcld.height = 96;\r\n                tmptile.x = 96 * i;\r\n                tmptile.y = 96 * j;\r\n                tmppool.push(tmptile);\r\n            }\r\n            this.tilePool.push(tmppool);\r\n            this.ifcanMove = true;\r\n        }\r\n        BattleMaps.currentBattleMap = battlemap;\r\n        for (let j = 0; j < 5; j++) {\r\n            for (let i = 0; i < 10; i++) {\r\n                if (battlemap[j][i] == 0) {\r\n                    this.mainsp.removeChild(this.tilePool[j][i]);\r\n                }\r\n                else {\r\n                    if (regiontype == RegionType.Grass) {\r\n                        this.mainsp.loadImage(\"Battle/GrassLand.png\");\r\n                        this.tilePool[j][i].value = BattleImage.grasstilename[battlemap[j][i]];\r\n                        this.mainsp.addChild(this.tilePool[j][i]);\r\n                    }\r\n                    if (regiontype == RegionType.Desert) {\r\n                        this.mainsp.loadImage(\"Battle/SandLand.png\");\r\n                        this.tilePool[j][i].value = BattleImage.deserttilename[battlemap[j][i]];\r\n                        this.mainsp.addChild(this.tilePool[j][i]);\r\n                    }\r\n                    if (regiontype == RegionType.Lava) {\r\n                        this.mainsp.loadImage(\"Battle/LavaLand.png\");\r\n                        this.tilePool[j][i].value = BattleImage.lavatilename[battlemap[j][i]];\r\n                        this.mainsp.addChild(this.tilePool[j][i]);\r\n                    }\r\n                    if (regiontype == RegionType.Snow) {\r\n                        this.mainsp.loadImage(\"Battle/SnowLand.png\");\r\n                        this.tilePool[j][i].value = BattleImage.snowtilename[battlemap[j][i]];\r\n                        this.mainsp.addChild(this.tilePool[j][i]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.enemyFactory.initEnemy(regiontype, enemyforce);\r\n    }\r\n    clearTiles() {\r\n        for (let j = 0; j < 5; j++) {\r\n            for (let i = 0; i < 10; i++) {\r\n                this.mainsp.removeChild(this.tilePool[j][i]);\r\n                let rg = this.tilePool[j][i].getComponent(Laya.RigidBody);\r\n                let bc = this.tilePool[j][i].getComponent(Laya.BoxCollider);\r\n                if (rg) {\r\n                    rg.enabled = false;\r\n                }\r\n                if (bc) {\r\n                    bc.enabled = false;\r\n                }\r\n                if (bc) {\r\n                    this.tilePool[j][i]._destroyComponent(bc);\r\n                }\r\n                if (rg) {\r\n                    this.tilePool[j][i]._destroyComponent(rg);\r\n                }\r\n                Laya.Pool.recover('TileType', this.tilePool[j][i]);\r\n            }\r\n        }\r\n    }\r\n}\r\nBattleImage.grasstilename = [\"\", \"一\", \"八\", \"匕\", \"厂\", \"刀\", \"儿\", \"二\"];\r\nBattleImage.sandtilename = [\"\", \"入\", \"十\", \"又\", \"川\", \"寸\", \"大\", \"飞\"];\r\nBattleImage.deserttilename = [\"\", \"广\", \"己\", \"口\", \"马\", \"门\", \"女\", \"山\"];\r\nBattleImage.snowtilename = [\"\", \"土\", \"兀\", \"夕\", \"小\", \"子\", \"贝\", \"比\"];\r\nBattleImage.lavatilename = [\"\", \"斗\", \"厄\", \"方\", \"风\", \"父\", \"戈\", \"户\"];\r\n",
  "references": [
    "/Users/huanggaole/PCGZelda/src/script/Region.ts",
    "/Users/huanggaole/PCGZelda/src/map/BattleMaps.ts",
    "/Users/huanggaole/PCGZelda/src/map/EnemyFactory.ts",
    "/Users/huanggaole/PCGZelda/src/map/BulletFactory.ts",
    "/Users/huanggaole/PCGZelda/src/scene/BattleScene.ts",
    "/Users/huanggaole/PCGZelda/src/events/toDown.ts",
    "/Users/huanggaole/PCGZelda/src/events/toUp.ts",
    "/Users/huanggaole/PCGZelda/src/events/toLeft.ts",
    "/Users/huanggaole/PCGZelda/src/events/toRight.ts"
  ]
}
